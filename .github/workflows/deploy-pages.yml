name: Deploy GitHub Pages

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run tests
        run: |
          python -m pytest test_app.py -v || true

      - name: Setup Pages
        uses: actions/configure-pages@v4
        with:
          enablement: true

      - name: Create documentation
        run: |
          mkdir -p _site

          # Create index.html with README content
          cat > _site/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Note Hub - Beautiful Notes App</title>
              <style>
                  * { margin: 0; padding: 0; box-sizing: border-box; }
                  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #333; background: #f5f5f5; }
                  .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; background: white; }
                  h1 { color: #2c3e50; margin: 30px 0 15px 0; }
                  h2 { color: #34495e; margin: 25px 0 10px 0; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
                  p { margin: 10px 0; }
                  ul, ol { margin: 15px 0 15px 20px; }
                  li { margin: 8px 0; }
                  code { background: #f4f4f4; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; }
                  pre { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 5px; overflow-x: auto; margin: 15px 0; }
                  pre code { background: none; padding: 0; color: #ecf0f1; }
                  a { color: #3498db; text-decoration: none; }
                  a:hover { text-decoration: underline; }
                  .btn { display: inline-block; background: #3498db; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; margin: 10px 0; }
                  .btn:hover { background: #2980b9; }
                  .feature { margin: 15px 0; }
                  table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                  th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                  th { background: #3498db; color: white; }
                  .highlight { background: #fff3cd; padding: 15px; border-left: 4px solid #ff9800; margin: 15px 0; }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>üóíÔ∏è Note Hub - Beautiful Notes App</h1>
                  <p>A modern, clean, and feature-rich personal notes application built with Flask.</p>
                  
                  <div class="highlight">
                      <h3>üöÄ Live Demo</h3>
                      <p><strong>Get started in 3 steps:</strong></p>
                      <pre><code>pip install -r requirements.txt
          python simple_app.py
          # Open http://127.0.0.1:5000</code></pre>
                      <p><strong>Default Login:</strong> admin / change-me</p>
                  </div>
                  
                  <h2>‚ú® Features</h2>
                  <ul>
                      <li>üìù Rich Markdown Editing - Full markdown support with live preview</li>
                      <li>üè∑Ô∏è Smart Tagging - Organize notes with tags and filter by them</li>
                      <li>üîç Powerful Search - Search notes by title, content, or tags</li>
                      <li>‚≠ê Favorites & Pinning - Mark important notes as favorites or pin them</li>
                      <li>üì± Responsive Design - Beautiful UI that works on all devices</li>
                      <li>üåô Dark Mode - Toggle between light and dark themes</li>
                      <li>üîê Secure - CSRF protection, input validation, and HTML sanitization</li>
                      <li>üìä Reading Time - Automatic reading time estimation</li>
                  </ul>
                  
                  <h2>üõ†Ô∏è Technology Stack</h2>
                  <ul>
                      <li><strong>Flask</strong> - Web framework</li>
                      <li><strong>SQLAlchemy</strong> - Database ORM</li>
                      <li><strong>WTForms</strong> - Form handling and validation</li>
                      <li><strong>Markdown</strong> - Content rendering</li>
                      <li><strong>Bleach</strong> - HTML sanitization</li>
                      <li><strong>Tailwind CSS</strong> - Modern styling</li>
                  </ul>
                  
                  <h2>üìñ Documentation</h2>
                  <p><a href="https://github.com/thienng-it/note-hub" class="btn">View on GitHub</a></p>
                  
                  <hr style="margin: 40px 0; border: none; border-top: 1px solid #ddd;">
                  <footer style="text-align: center; color: #666; font-size: 14px;">
                      <p>Note Hub ¬© 2025 - Built with ‚ù§Ô∏è using Flask</p>
                  </footer>
              </div>
          </body>
          </html>
          EOF

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: "_site"

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
